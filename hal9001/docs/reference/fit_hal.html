<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>HAL: The Highly Adaptive Lasso — fit_hal • hal9001</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="HAL: The Highly Adaptive Lasso — fit_hal" />
<meta property="og:description" content="Estimation procedure for HAL, the Highly Adaptive Lasso" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115145808-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115145808-1');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hal9001</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="https://tlverse.org">tlverse</a>
</li>
<li>
  <a href="../articles/intro_hal9001.html">Overview</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/tlverse/hal9001">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>HAL: The Highly Adaptive Lasso</h1>
    <small class="dont-index">Source: <a href='https://github.com/tlverse/hal9001/blob/master/R/hal.R'><code>R/hal.R</code></a></small>
    <div class="hidden name"><code>fit_hal.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimation procedure for HAL, the Highly Adaptive Lasso</p>
    </div>

    <pre class="usage"><span class='fu'>fit_hal</span>(
  <span class='no'>X</span>,
  <span class='no'>Y</span>,
  <span class='kw'>X_unpenalized</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>max_degree</span> <span class='kw'>=</span> <span class='fl'>3</span>,
  <span class='kw'>fit_type</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"glmnet"</span>, <span class='st'>"lassi"</span>),
  <span class='kw'>n_folds</span> <span class='kw'>=</span> <span class='fl'>10</span>,
  <span class='kw'>foldid</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>use_min</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>reduce_basis</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>family</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"gaussian"</span>, <span class='st'>"binomial"</span>, <span class='st'>"cox"</span>),
  <span class='kw'>return_lasso</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>return_x_basis</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>basis_list</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>lambda</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>id</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>offset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>cv_select</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='no'>...</span>,
  <span class='kw'>yolo</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>X</th>
      <td><p>An input <code>matrix</code> containing observations and covariates.</p></td>
    </tr>
    <tr>
      <th>Y</th>
      <td><p>A <code>numeric</code> vector of obervations of the outcome variable.</p></td>
    </tr>
    <tr>
      <th>X_unpenalized</th>
      <td><p>An input <code>matrix</code> with the same format as X, that
directly get appended into the design matrix (no basis expansion). No L-1
penalization is performed on these covariates.</p></td>
    </tr>
    <tr>
      <th>max_degree</th>
      <td><p>The highest order of interaction terms for which the basis
functions ought to be generated. The default (<code>NULL</code>) corresponds to
generating basis functions for the full dimensionality of the input matrix.</p></td>
    </tr>
    <tr>
      <th>fit_type</th>
      <td><p>The specific routine to be called when fitting the Lasso
regression in a cross-validated manner. Choosing the <code>glmnet</code> option
will result in a call to <code><a href='https://rdrr.io/pkg/glmnet/man/cv.glmnet.html'>cv.glmnet</a></code> while <code>lassi</code>
will produce a (faster) call to a custom Lasso routine.</p></td>
    </tr>
    <tr>
      <th>n_folds</th>
      <td><p>Integer for the number of folds to be used when splitting the
data for V-fold cross-validation. This defaults to 10.</p></td>
    </tr>
    <tr>
      <th>foldid</th>
      <td><p>An optional vector of values between 1 and <code>n_folds</code>
identifying what fold each observation is in. If supplied, <code>n_folds</code>
can be missing. When supplied, this is passed to
<code><a href='https://rdrr.io/pkg/glmnet/man/cv.glmnet.html'>cv.glmnet</a></code>.</p></td>
    </tr>
    <tr>
      <th>use_min</th>
      <td><p>Determines which lambda is selected from
<code><a href='https://rdrr.io/pkg/glmnet/man/cv.glmnet.html'>cv.glmnet</a></code>. <code>TRUE</code> corresponds to
<code>"lambda.min"</code> and <code>FALSE</code> corresponds to <code>"lambda.1se"</code>.</p></td>
    </tr>
    <tr>
      <th>reduce_basis</th>
      <td><p>A <code>numeric</code> value bounded in the open interval
(0,1) indicating the minimum proportion of 1's in a basis function column
needed for the basis function to be included in the procedure to fit the
Lasso. Any basis functions with a lower proportion of 1's than the cutoff
will be removed. This argument defaults to <code>NULL</code>, in which case all
basis functions are used in the lasso-fitting stage of the HAL algorithm.</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>A <code>character</code> corresponding to the error family for a
generalized linear model. Options are limited to "gaussian" for fitting a
standard linear model, "binomial" for penalized logistic regression,
"cox" for a penalized proportional hazards model. Note that in the case of
"binomial" and "cox" the argument fit_type is limited to "glmnet"; thus,
documentation of the glmnet package should be consulted for any errors
resulting from the Lasso fitting step in these cases.</p></td>
    </tr>
    <tr>
      <th>return_lasso</th>
      <td><p>A <code>logical</code> indicating whether or not to return
the <code>glmnet</code> fit of the lasso model.</p></td>
    </tr>
    <tr>
      <th>return_x_basis</th>
      <td><p>A <code>logical</code> indicating whether or not to return
the matrix of (possibly reduced) basis functions used in the HAL lasso fit.</p></td>
    </tr>
    <tr>
      <th>basis_list</th>
      <td><p>The full set of basis functions generated from the input
data X (via a call to <code>enumerate_basis</code>). The dimensionality of this
structure is dim = (n * 2^(d - 1)), where n is the number of observations
and d is the number of columns in X.</p></td>
    </tr>
    <tr>
      <th>lambda</th>
      <td><p>User-specified array of values of the lambda tuning parameter
of the Lasso L1 regression. If <code>NULL</code>, <code><a href='https://rdrr.io/pkg/glmnet/man/cv.glmnet.html'>cv.glmnet</a></code>
will be used to automatically select a CV-optimal value of this
regularization parameter. If specified, the Lasso L1 regression model will
be fit via <code>glmnet</code>, returning regularized coefficient values for each
value in the input array.</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>a vector of ID values, used to generate cross-validation folds for
cross-validated selection of the regularization parameter lambda.</p></td>
    </tr>
    <tr>
      <th>offset</th>
      <td><p>a vector of offset values, used in fitting.</p></td>
    </tr>
    <tr>
      <th>cv_select</th>
      <td><p>A <code>logical</code> specifying whether the array of values
specified should be passed to <code><a href='https://rdrr.io/pkg/glmnet/man/cv.glmnet.html'>cv.glmnet</a></code> in order to
pick the optimal value (based on cross-validation) (when set to
<code>TRUE</code>) or to simply fit along the sequence of values (or single
value) using <code><a href='https://rdrr.io/pkg/glmnet/man/glmnet.html'>glmnet</a></code> (when set to <code>FALSE</code>).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other arguments passed to <code><a href='https://rdrr.io/pkg/glmnet/man/cv.glmnet.html'>cv.glmnet</a></code>. Please
consult its documentation for a full list of options.</p></td>
    </tr>
    <tr>
      <th>yolo</th>
      <td><p>A <code>logical</code> indicating whether to print one of a curated
selection of quotes from the HAL9000 computer, from the critically
acclaimed epic science-fiction film "2001: A Space Odyssey" (1968).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Object of class <code>hal9001</code>, containing a list of basis
 functions, a copy map, coefficients estimated for basis functions, and
 timing results (for assessing computational efficiency).</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The procedure uses a custom C++ implementation to generate a design
 matrix consisting of basis functions corresponding to covariates and
 interactions of covariates and to remove duplicate columns of indicators.
 The Lasso regression is fit to this (usually) very wide matrix using either
 a custom implementation (based on <span class="pkg">origami</span>) or by a call to
 <code><a href='https://rdrr.io/pkg/glmnet/man/cv.glmnet.html'>cv.glmnet</a></code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
<span class='no'>n</span> <span class='kw'>&lt;-</span> <span class='fl'>100</span>
<span class='no'>p</span> <span class='kw'>&lt;-</span> <span class='fl'>3</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='no'>xmat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='no'>n</span> * <span class='no'>p</span>), <span class='no'>n</span>, <span class='no'>p</span>)
<span class='no'>y_prob</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span>(<span class='fl'>3</span> * <span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>sin</a></span>(<span class='no'>x</span>[, <span class='fl'>1</span>]) + <span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>sin</a></span>(<span class='no'>x</span>[, <span class='fl'>2</span>]))
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Binomial.html'>rbinom</a></span>(<span class='kw'>n</span> <span class='kw'>=</span> <span class='no'>n</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>prob</span> <span class='kw'>=</span> <span class='no'>y_prob</span>)
<span class='no'>ml_hal_fit</span> <span class='kw'>&lt;-</span> <span class='fu'>fit_hal</span>(<span class='kw'>X</span> <span class='kw'>=</span> <span class='no'>x</span>, <span class='kw'>Y</span> <span class='kw'>=</span> <span class='no'>y</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"binomial"</span>, <span class='kw'>yolo</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='no'>preds</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>ml_hal_fit</span>, <span class='kw'>new_data</span> <span class='kw'>=</span> <span class='no'>x</span>)
<span class='co'># }</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Jeremy Coyle, Nima Hejazi, Mark van der Laan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


